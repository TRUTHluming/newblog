<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è¡—å¤´ç”Ÿå­˜ï¼šç®—æ³•æ‰“å·¥ä»”</title>
    <style>
        /* --- åŸºç¡€æ ·å¼ --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Courier New', Courier, monospace;
            background: #000;
            color: #0f0;
        }

        /* --- æ‘„åƒå¤´èƒŒæ™¯ --- */
        #camera-feed {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1;
            filter: grayscale(30%) contrast(1.2); /*ç¨å¾®åŠ ç‚¹æ»¤é•œå¢åŠ å‹æŠ‘æ„Ÿ*/
        }

        /* --- UI å±‚ --- */
        #ui-layer {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            pointer-events: none; /* è®©ç‚¹å‡»ç©¿é€åˆ°ä¸‹é¢çš„æŒ‰é’® */
        }

        /* --- é¡¶éƒ¨ HUD --- */
        .hud-top {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            border: 1px solid #0f0;
            border-radius: 5px;
            pointer-events: auto;
        }

        .coin-display {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .goal-display {
            font-size: 0.9rem;
            color: #fff;
        }

        /* --- ä»»åŠ¡æ°”æ³¡ (ARå…ƒç´ ) --- */
        .job-bubble {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            pointer-events: auto;
            animation: float 3s infinite ease-in-out;
            transition: transform 0.2s;
            box-shadow: 0 0 15px rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .job-bubble:active {
            transform: scale(0.9);
        }

        /* åƒåœ¾å·¥ä½œæ ·å¼ */
        .job-bad {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff4444;
            color: #ffcccc;
        }

        /* ç¥ä»™å·¥ä½œæ ·å¼ */
        .job-good {
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid #ffd700;
            color: #fff;
            box-shadow: 0 0 20px #ffd700;
            z-index: 100;
        }

        .job-dist { font-size: 0.8rem; }
        .job-pay { font-size: 1.2rem; font-weight: bold; }

        /* --- å·¥ä½œè¿›è¡Œä¸­é®ç½© --- */
        #working-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 20;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            pointer-events: auto;
        }

        .progress-bar-container {
            width: 80%;
            height: 20px;
            background: #333;
            border: 1px solid #0f0;
            margin-top: 20px;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: #0f0;
            transition: width 0.1s linear;
        }

        /* --- é€šå…³/å¤±è´¥ --- */
        #end-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 30;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            pointer-events: auto;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
            100% { transform: translateY(0px); }
        }

        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            margin-top: 20px;
            font-family: inherit;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <video id="camera-feed" autoplay playsinline muted></video>

    <div id="ui-layer">
        <div class="hud-top">
            <div class="coin-display">ğŸ’° <span id="coins">0</span></div>
            <div class="goal-display">ç›®æ ‡: 100 | <span id="status-text">å¯»æ‰¾å·¥ä½œä¸­...</span></div>
        </div>
        
        <div id="jobs-container"></div>
    </div>

    <div id="working-overlay">
        <h2 id="work-title">æ­£åœ¨æ¬ç –...</h2>
        <p>è·ç¦»ç›®çš„åœ°è¿˜æœ‰: <span id="work-dist">0</span>km</p>
        <div class="progress-bar-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">(æ¨¡æ‹Ÿè¡Œèµ°ä¸­ï¼Œè¯·å‹¿å…³é—­)</p>
    </div>

    <div id="end-screen">
        <h1 id="end-title">æ­å–œé€šå…³ï¼</h1>
        <p id="end-desc">ä½ ç»ˆäºæ”’å¤Ÿäº†ä¹°ä¸€å¼ ç¦»å¼€è¿™é‡Œçš„è½¦ç¥¨é’±ã€‚</p>
        <button onclick="location.reload()">é‡æ–°å¼€å§‹</button>
    </div>

    <script>
        // --- æ¸¸æˆæ•°æ® ---
        let coins = 0;
        const GOAL = 100;
        let isWorking = false;
        
        const uiCoins = document.getElementById('coins');
        const jobsContainer = document.getElementById('jobs-container');
        const workingOverlay = document.getElementById('working-overlay');
        const progressBar = document.getElementById('progress');
        const workDistDisplay = document.getElementById('work-dist');
        const statusText = document.getElementById('status-text');

        // --- 1. åˆå§‹åŒ–æ‘„åƒå¤´ ---
        async function initCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: "environment" } // ä¼˜å…ˆä½¿ç”¨åç½®æ‘„åƒå¤´
                });
                const video = document.getElementById('camera-feed');
                video.srcObject = stream;
            } catch (err) {
                alert("æ— æ³•è®¿é—®æ‘„åƒå¤´ã€‚è¯·ç¡®ä¿å…è®¸æƒé™æˆ–ä½¿ç”¨HTTPS/Localhostç¯å¢ƒã€‚");
                console.error(err);
                // å¦‚æœæ²¡æœ‰æ‘„åƒå¤´ï¼Œç”¨ç°è‰²èƒŒæ™¯ä»£æ›¿ï¼Œä¿è¯æ¸¸æˆèƒ½ç©
                document.getElementById('camera-feed').style.background = "#222";
            }
        }

        // --- 2. ä»»åŠ¡ç”Ÿæˆç®—æ³• (æ ¸å¿ƒé€»è¾‘) ---
        function spawnJob() {
            if (isWorking || coins >= GOAL) return;

            const jobEl = document.createElement('div');
            jobEl.classList.add('job-bubble');

            // å†³å®šå·¥ä½œç±»å‹ (90% åå·¥ä½œ, 10% å¥½å·¥ä½œ)
            const isGoodJob = Math.random() > 0.90;

            let distance, pay, typeName;

            if (isGoodJob) {
                // å¥½å·¥ä½œï¼šè·ç¦»è¿‘ (0.1 - 0.5km)ï¼Œé’±å¤š (15 - 30é‡‘å¸)
                distance = (Math.random() * 0.4 + 0.1).toFixed(1);
                pay = Math.floor(Math.random() * 15) + 15;
                typeName = "ğŸ”¥ç¦åˆ©å•";
                jobEl.classList.add('job-good');
                
                // å¥½å·¥ä½œæ¶ˆå¤±å¾—å¿«
                setTimeout(() => {
                    if(jobEl.parentNode) jobEl.remove();
                }, 3000); 
            } else {
                // åå·¥ä½œï¼šè·ç¦»è¿œ (2.0 - 8.0km)ï¼Œé’±å°‘ (1 - 5é‡‘å¸)
                distance = (Math.random() * 6 + 2.0).toFixed(1);
                pay = Math.floor(Math.random() * 5) + 1;
                typeName = "è‹¦åŠ›æ´»";
                jobEl.classList.add('job-bad');
            }

            // éšæœºå±å¹•ä½ç½®
            const top = Math.random() * 60 + 20; // 20% - 80%
            const left = Math.random() * 80 + 10; // 10% - 90%
            jobEl.style.top = top + '%';
            jobEl.style.left = left + '%';

            jobEl.innerHTML = `
                <div style="font-size:0.8rem">${typeName}</div>
                <div class="job-dist">${distance}km</div>
                <div class="job-pay">Â¥${pay}</div>
            `;

            // ç‚¹å‡»æ¥å•
            jobEl.onclick = () => startWork(distance, pay);

            jobsContainer.appendChild(jobEl);

            // åå·¥ä½œå­˜åœ¨æ—¶é—´ä¹…ä¸€ç‚¹
            if (!isGoodJob) {
                setTimeout(() => {
                    if(jobEl.parentNode) jobEl.remove();
                }, 8000);
            }
        }

        // --- 3. å·¥ä½œ/è¡Œèµ°é€»è¾‘ ---
        function startWork(distance, pay) {
            isWorking = true;
            jobsContainer.innerHTML = ''; // æ¸…ç©ºå±å¹•ä¸Šçš„å…¶ä»–ä»»åŠ¡
            workingOverlay.style.display = 'flex';
            statusText.innerText = "å·¥ä½œä¸­...";
            
            // æ¸¸æˆæ€§è®¾å®šï¼š1km éœ€è¦ 1ç§’é’Ÿ (æ¨¡æ‹Ÿï¼Œå®é™…å¯è°ƒæ…¢)
            // å¦‚æœæƒ³æ›´è®½åˆºï¼Œå¯ä»¥æŠŠåå·¥ä½œçš„è€—æ—¶ç³»æ•°è°ƒé«˜
            const timePerKm = 1000; 
            const totalTime = distance * timePerKm;
            let timeElapsed = 0;

            const interval = setInterval(() => {
                timeElapsed += 50; // æ¯50msæ›´æ–°ä¸€æ¬¡
                const percentage = (timeElapsed / totalTime) * 100;
                
                // æ›´æ–°UI
                progressBar.style.width = percentage + '%';
                const distLeft = (distance - (distance * (percentage/100))).toFixed(1);
                workDistDisplay.innerText = distLeft;

                if (timeElapsed >= totalTime) {
                    clearInterval(interval);
                    completeWork(pay);
                }
            }, 50);
        }

        function completeWork(pay) {
            isWorking = false;
            workingOverlay.style.display = 'none';
            coins += pay;
            uiCoins.innerText = coins;
            statusText.innerText = `èµšäº† ${pay} é‡‘å¸!`;

            if (coins >= GOAL) {
                winGame();
            } else {
                setTimeout(() => {
                    statusText.innerText = "å¯»æ‰¾å·¥ä½œä¸­...";
                }, 2000);
            }
        }

        // --- 4. æ¸¸æˆå¾ªç¯ ---
        function winGame() {
            document.getElementById('end-screen').style.display = 'flex';
        }

        // å¯åŠ¨
        initCamera();
        
        // å®šæ—¶ç”Ÿæˆä»»åŠ¡
        setInterval(() => {
            // æœ€å¤šåŒæ—¶å­˜åœ¨ 4 ä¸ªä»»åŠ¡
            if (jobsContainer.children.length < 4) {
                spawnJob();
            }
        }, 2000);

    </script>
</body>
</html>