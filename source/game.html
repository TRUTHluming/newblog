<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Street Survival: The Coder‚Äôs Quest</title>
<style>
  body {
    text-align: center;
    font-family: Arial, sans-serif;
    margin-top: 60px;
    background-color: #f9f9f9;
  }
  h2 {
    color: #333;
  }
  #money, #goal {
    font-size: 20px;
    margin: 10px;
  }
  #status, #distance {
    font-size: 18px;
    margin-top: 20px;
  }
  #complete {
    font-size: 22px;
    color: green;
    margin-top: 30px;
    display: none;
  }
  button {
    font-size: 16px;
    margin-top: 20px;
    padding: 10px 20px;
  }
</style>
</head>
<body>

<h2>Street Survival: The Coder‚Äôs Quest</h2>
<div id="money">üí∞ 0</div>
<div id="goal">Goal: 100 | Searching for work...</div>
<p id="status">Working hard... collecting experience...</p>
<p id="distance">Distance remaining: calculating...</p>
<p id="complete">üéâ Congratulations! You've earned your ticket to leave this place!</p>
<button id="restart" onclick="location.reload()" style="display:none;">Restart</button>

<script>
let targetDistance = 100; // required meters to complete
let startPos = null;
let currentMoney = 0;
let goal = 100;
let hasCompleted = false;

// Haversine formula for distance between two GPS coordinates
function haversine(lat1, lon1, lat2, lon2) {
  const R = 6371e3; // Earth radius in meters
  const toRad = x => x * Math.PI / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a = Math.sin(dLat / 2) ** 2 +
            Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
            Math.sin(dLon / 2) ** 2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
}

function updateDisplay(dist) {
  if (hasCompleted) return;
  document.getElementById("distance").textContent = 
    `Distance moved: ${dist.toFixed(1)} m / ${targetDistance} m`;

  // Simulate earning money as distance increases
  let progress = Math.min(dist / targetDistance, 1);
  currentMoney = Math.floor(progress * goal);
  document.getElementById("money").textContent = `üí∞ ${currentMoney}`;

  if (dist >= targetDistance) {
    hasCompleted = true;
    document.getElementById("status").textContent = "You‚Äôve reached your goal!";
    document.getElementById("complete").style.display = "block";
    document.getElementById("restart").style.display = "inline-block";
  }
}

// Begin GPS tracking
if (navigator.geolocation) {
  navigator.geolocation.watchPosition(pos => {
    if (!startPos) startPos = pos.coords;
    const dist = haversine(startPos.latitude, startPos.longitude,
                           pos.coords.latitude, pos.coords.longitude);
    updateDisplay(dist);
  }, err => {
    document.getElementById("status").textContent =
      "‚ö†Ô∏è Please enable location access to play this game.";
  }, {
    enableHighAccuracy: true,
    maximumAge: 1000,
    timeout: 10000
  });
} else {
  document.getElementById("status").textContent =
    "Your device does not support location detection.";
}
</script>

</body>
</html>
